# ID Contract API

This repository includes an API around Ethereum smart contracts to make them compatible with web 2.0 applications. It includes SSL encryption and closed endpoints that only allow for authenticated access via JSON Web Tokens, generated by [Auth0](https://auth0.com/). The API is built using [Connexion](https://github.com/zalando/connexion), the first framework for Python to implement [OpenAPI](https://swagger.io/docs/specification/about/). It is served via [gunicorn](https://gunicorn.org/), watched by [supervisor](http://supervisord.org/) and proxied by [Nginx](https://www.nginx.com/).

## Development Setup

1. Clone the repository and navigate inside it

2. Compile the smart contracts

        $ truffle compile

3. Deploy the search contract

        $ truffle migrate --network development

4. Update the search contract address in the docker-compose file

5. Start all docker containers

        $ docker-compose up
    Wait for about a minute until all is configured correctly.

You can explore the API by visiting http://localhost:8000/v0.1/ui/. It is not functioning though due to the lack of a valid JWT.

To rebuild the image, call

    $ docker-compose build

## Deployment

1. Deploy the search contract to a network of your choice. Adjust the `truffle.js` file by adding the correct host IP.

2. Update the RPC_HOST to the right host IP and set the search contract address in the docker-compose file.

3. Close the direct access to the API by removing the lines 
    ```
    ports:
        - "8000:8000"
    ```
    from the `docker-compose.yml`

4. Change the environment variables 
    ```
    AUTH0_DOMAIN: "your.domain.auth0.com"
    API_IDENTIFIER: "https://your.domain/yourapi"
    ```
    in the `docker-compose.yml` to contain your Auth0 parameters.

5. Place your certificates in the folder `$HOME/cert$`.

6. Adjust the file `./nginx/nginx.conf` to contain the names of your certificates. 